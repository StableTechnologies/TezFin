<html><head><style>/* Copyright 2022-2023 Morum LLC, 2019-2022 Smart Chain Arena LLC */

:root {
  --primary: #006dcc;
  --primary-text-color: #212529;

  --background-color: #fafafa;
  --link-color: #01608c;
  --button-hover-color: #e8e8e8;
  --menu-bg-color: #f1f1f1;
  --border-color: #d3d3d3;

  --output-bgok: #f1f1fa;
  --output-bgko: #faf1f1;

  --danger-color: #dc3545;
  --dataColumn-color: #290075;
  --simulationBuilder-bg-color: #fffdeb;
  --tabcontentshow-bg-color: #ccffcc;

  --key-address-color: #006600;
  --timestamp-color: #6600aa;
  --code-type-color: #331188;
  --code-variable-color: #aa0000;
  --code-store-color: #0000aa;
  --code-constant-color: #000088;
  --code-cons-color: #0000aa;
  --code-comment-color: #006600;

  --button-bg-color: #006dcc;
  --button-font-color: #fff;

  /* Wallet colors */
  --applied-op-color: #e8ffc2;
  --failed-op-color: #ffcfbf;
}

button.editor-menu-btn:not([disabled]):hover {
  color: var(--primary-text-color);
  background-color: var(--background-color);
}

button.editor-menu-btn:disabled,
button.editor-menu-btn:disabled:hover {
  opacity: 0.5;
  cursor: default;
  background-color: initial;
  text-decoration: none;
}

#outputPanel.empty-output {
  background: rgba(255, 255, 255, 0.9) url(../smartPY.only.transp.png)
    center/40% no-repeat;
  background-blend-mode: color;
}

#logo-image {
  background: url(../smartPY_horizon.transp.png) left/75% no-repeat;
}

#editor-link {
  background-image: url(../svgs/terminal.svg);
}

#wallet-link {
  background-image: url(../svgs/wallet-dark.svg);
}

#faucet-link {
  background-image: url(../svgs/faucet.svg);
}

#explorer-link {
  background-image: url(../svgs/search.svg);
}

#node_explorer-link {
  background-image: url(../svgs/search.svg);
}

#michelson-link {
  background-image: url(../svgs/stream.svg);
}

#help-link {
  background-image: url(../svgs/question.svg);
}

#origination-link {
  background-image: url(../svgs/stream.svg);
}

#ledger-img {
  background-image: url(../svgs/ledger-dark.svg);
  background-repeat: no-repeat;
}

@media (prefers-color-scheme: dark) {
  :root {
    --primary: #006dcc;
    --primary-text-color: #fafafa;

    --background-color: #212529;
    --link-color: #66aacc;
    --button-hover-color: slategray;
    --menu-bg-color: #05385c;
    --border-color: #d3d3d3;

    --output-bgok: #05364a;
    --output-bgko: #4a3605;

    --danger-color: #dc3545;
    --dataColumn-color: blanchedalmond;
    --simulationBuilder-bg-color: #444488;
    --tabcontentshow-bg-color: darkgreen;

    --key-address-color: chocolate;
    --timestamp-color: aqua;
    --code-type-color: magenta;
    --code-variable-color: khaki;
    --code-store-color: greenyellow;
    --code-constant-color: red;
    --code-cons-color: hotpink;
    --code-comment-color: chocolate;

    --button-bg-color: #fff;
    --button-font-color: #000;
  }

  button.editor-menu-btn:not([disabled]):hover {
    color: var(--background-color);
    background-color: #e8e8e8;
  }

  .right-submenu button,
  .pretty-submenu button {
    background-color: var(--primary-text-color);
  }

  #outputPanel.empty-output {
    background: rgba(30, 30, 30, 0.8) url(../logo-transp.png)
      center/40% no-repeat;
    background-blend-mode: color;
  }

  #logo-image {
    background: url(../dm-logo.png) left/75% no-repeat;
  }

  .modal-content {
    background-color: var(--menu-bg-color);
  }

  /** Dark mode header icons*/
  #editor-link {
    background-image: url(../svgs/dm-terminal.svg);
  }

  #wallet-link {
    background-image: url(../svgs/wallet-dark.svg);
  }

  #faucet-link {
    background-image: url(../svgs/dm-faucet.svg);
  }

  #explorer-link {
    background-image: url(../svgs/dm-search.svg);
  }

  #node_explorer-link {
    background-image: url(../svgs/dm-search.svg);
  }

  #michelson-link {
    background-image: url(../svgs/dm-stream.svg);
  }

  #help-link {
    background-image: url(../svgs/dm-question.svg);
  }

  #origination-link {
    background-image: url(../svgs/dm-stream.svg);
  }
}

body,
html {
  height: 100%;
  padding: 0;
  margin: 0;
  color: var(--primary-text-color);
}

body {
  background-color: var(--background-color);
}

main {
  height: 100%;
  display: grid;
  grid-template-columns: 1fr 20px 1fr;
  grid-template-rows: max-content max-content minmax(1px, 1fr);
  grid-template-areas:
    'menu menu menu'
    'submenu submenu submenu'
    'editorDiv centerCol outputPanel';
}

button {
  border-radius: 3px;
  background-color: inherit;
  border-width: 1px;
  border-style: solid;
  border-color: rgb(216, 216, 216) rgb(209, 209, 209)
    rgb(186, 186, 186);
  color: inherit;
}

button[onclick]:hover,
button[data-toggle]:hover {
  cursor: pointer;
  background-color: var(--button-hover-color);
}

button.text-button {
  border: none;
  background-color: inherit;
  color: var(--link-color);
  text-align: left;
  padding-left: 0;
  padding-right: 0;
}

button.text-button:hover {
  text-decoration: underline;
  box-shadow: none;
  font-weight: bold;
}

button.text-button:active,
button.text-button:focus {
  outline: none;
  font-weight: bold;
}

/** Main Nav **/
header {
  position: fixed;
  width: 100%;
  background-color: var(--background-color);
  top: 0;
  z-index: 99999999999;
}

header .navbar-toggler {
  background-color: #fafafa; /** Note: same color in both light and dark mode */
}

.top-bar {
  display: flex;
  justify-content: space-between;
  border-bottom: 1px solid var(--menu-bg-color);
}

.logo {
  margin: 0.6em;
}

.logo img,
.logo div {
  height: 42px;
}

.logo a:hover {
  background-color: inherit !important;
}

.logo p {
  margin: -10px 0 0 40px;
  font-variant: small-caps;
  font-family: Verdana, sans-serif;
}

#mainNav .container {
  display: flex;
  justify-content: flex-end;
  padding-right: 0;
}

#mainNav .row {
  margin: 0 0 3px 0;
}

.nav-icon {
  height: 14px !important;
}

.nav-item {
  margin: 0 2px;
}

.nav-link {
  padding: 0.25rem 1rem;
}

.nav-link {
  color: inherit !important;
  opacity: 0.5;
}

.active {
  border-bottom: 2px solid var(--primary-text-color);
  opacity: 1;
}

.nav-link > div {
  display: flex;
  flex-direction: row;
  align-items: center;
}

.nav-link span {
  padding-right: 0.33rem;
}

.nav-icon {
  height: 14px;
  width: 14px;
  display: inline-flex;
  background-position: bottom;
  background-repeat: no-repeat;
  background-size: 14px;
}

/** End Main nav **/

/** Editor menus **/

.editor-nav {
  padding: 3px;
}

.editor-nav .dropdown {
  margin: 0 2px;
}

.dropdown-item.active,
.dropdown-item:active {
  background-color: var(--primary);
}

.dropdown-menu li {
  margin-bottom: 0;
}

button.editor-menu-btn {
  border: none;
  min-width: 4.1rem;
  color: inherit;
}

button.editor-menu-btn:hover {
  text-decoration: underline;
}

.submenu {
  grid-area: submenu;
  border: 1px solid var(--border-color);
  background-color: var(--menu-bg-color);
  padding: 2px 3px 3px 3px;
  margin: 0px;
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  align-items: center;
  justify-content: flex-start;
}

.editor-nav > button {
  margin: 0px 2px;
}

.with-key-commands {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
}

.spacer {
  width: 8rem;
}

.right-submenu button,
.pretty-submenu button {
  margin: 0px 0.25rem;
  display: flex;
  align-items: center;
}

.right-submenu,
.pretty-submenu {
  display: inline-flex;
  margin: 0 3px;
}

.right-submenu {
  padding-left: 0rem;
}

.pretty-submenu button span {
  margin-left: 0.25rem;
}

#dynamicButtons > button {
  padding-bottom: 4px;
}
/** End Editor Menu **/

/** Editor layout **/
main,
#help,
#explorer,
#node_explorer,
#faucet,
#origination,
#faq,
#wallet {
  padding-top: 76px;
}

main.layout-side-by-side {
  grid-template-columns: 1fr 20px 1fr;
}

main.layout-output-only {
  grid-template-columns: 0 0 1fr;
}

main.layout-editor-only {
  grid-template-columns: 1fr 0 0;
}

main.layout-stacked {
  display: flex;
  flex-direction: column;
  overflow-y: scroll;
}

main.layout-side-by-side #outputPanel,
main.layout-output-only #outputPanel {
  display: block;
}

main.layout-editor-only #outputPanel {
  display: none;
}

main.layout-stacked #outputPanel,
main.layout-stacked #editorDiv {
  height: 50%;
  display: block;
}

/** End Editor layout **/

#editorDiv {
  grid-area: editorDiv;
  display: inline-block;
}

#centerCol {
  grid-area: centerCol;
  display: inline-block;
  background-color: var(--menu-bg-color);
  margin: 5px;
  padding: 0;
}

#outputPanel {
  grid-area: outputPanel;
  overflow: scroll;
  margin: 0px;
  padding: 5px;
  background-size: 40%;
  background-blend-mode: color;
}

#outputPanel.empty-output span {
  opacity: 0.5;
}

.operation {
  padding: 0.5rem;
  margin-top: 1rem;
  margin-bottom: 1rem;
}

#outputPanel .contract {
  padding: 0.5rem;
}

#outputPanel .execMessage {
  padding: 0.5rem;
}

#outputPanel .contract,
#outputPanel .execMessage {
  overflow-x: auto;
}

.menu {
  grid-area: menu;
  overflow: hidden;
  border: none;
  background-color: var(--menu-bg-color);
  padding: 10px 10px;
  margin: 0px;
}

.menu a {
  padding: 1px 10px;
}

#help,
#explorer,
#node_explorer,
#faucet,
#origination,
#faq,
#wallet {
  margin: 1rem 2rem;
}

/** Overwrite bootstrap modal lg max width **/
.modal-lg {
  max-width: 900px;
}

/** Overwrite bootstrap .close button color to work in dark mode **/
.close {
  color: var(--primary-text-color);
}

.selection {
  margin-left: 0px;
  margin-top: 2px;
  margin-bottom: 2px;
  margin-right: 2px;
  height: 30px;
  min-width: 100px;
}

.radio_selection {
  margin: 2px;
  height: 12px;
  width: 20px;
}

div.hidden {
  display: none;
}

div#terms {
  width: 80%;
  max-height: 60%;
}

div.on {
  margin-left: 20px;
  white-space: nowrap;
}

td.data {
  margin-left: 20px;
  padding-left: 20px;
}

input {
  width: 200px;
  height: 30px;
  font-size: 12px;
  margin: 2px;
}

.no-margin-list li {
  margin: 0;
}

td.dataColumn {
  margin-left: 20px;
  padding-left: 20px;
  color: var(--dataColumn-color);
}

div.simulationBuilder {
  border: 2px solid var(--border-color);
  padding-left: 5px;
  margin-bottom: 20px;
}

.steps {
  border: 2px solid var(--border-color);
  margin-left: 10px;
  margin-bottom: 10px;
  padding: 2px;
}

#outputPanel > div {
  border: 1px solid var(--border-color);
}

.contract,
.execMessageOK {
  background-color: var(--output-bgok);
}

.execMessageKO {
  background-color: var(--output-bgko);
}

/* div.python {
    border-left: 3px solid #aaaaaa;
    background-color: #ffeeee;
}
*/

/* .michelson {
    background-color: var(--output-bg);
} */

pre {
  color: inherit;
}

input.smallCheck {
  margin: 0px;
  padding: 0px;
  width: 15px;
}

textarea.smallMultilineArea {
  width: 100%;
  height: 400px;
  font-size: 15px;
  font-family: monospace;
}

#shareLink,
#loadLink {
  width: 100%;
  height: 300px;
  resize: vertical;
  font-size: 15px;
  font-family: monospace;
}

.resize_both {
  resize: both;
}

div.michelsonLine {
  padding-left: 2em;
  text-indent: -2em;
}

.white-space-pre,
.white-space-pre-wrap {
  font-family: monospace;
  white-space: pre;
  overflow-x: scroll;
}

.white-space-pre-wrap {
  white-space: pre-wrap;
}

div.message {
  border-left: 1px solid var(--border-color);
  background-color: #fafad2;
}
/* div.messageBox {
    float : left;
    background-color: #dddddd;
    padding : 3px;
    margin-right:5px;
} */

/* div.event {
    border-left: 1px solid #aaaaaa;
    background-color: #f6e1ff;
} */
/* div.eventBox {
    float : left;
    background-color: #dddddd;
    padding : 3px;
    margin-right:5px;
} */

/* div.scenario {
    background-color: #fdd598;
    padding-left : 30px;
    margin-right:15px;
} */

/* div.scenario1 {
    background-color: #fdd598;
    padding-left : 10px;
    margin-right:15px;
    border-left: 2px solid #444444;
    margin-left: 10px;
}

div.scenario2 {
    background-color: #d5fd98;
    padding-left : 10px;
    margin-right:15px;
    border-left: 2px solid #444444;
    margin-left: 10px;
}

div.scenario3 {
    background-color: #fd98d5;
    padding-left : 10px;
    margin-right:15px;
    border-left: 2px solid #444444;
    margin-left: 10px;
} */

div.error {
  border-left: 1px solid #aaaaaa;
  background-color: var(--output-bgko);
}

div.effect {
  border: 1px solid #cccccc;
  padding: 3px;
}

div.effectBox {
  float: left;
  background-color: #dddddd;
  padding: 3px;
}

div.transition {
  border-left: 3px solid #cccccc;
  background-color: #eeeeee;
  padding: 5px;
}

div.reset {
  clear: both;
}

div.subtype {
  margin-left: 1px;
  padding: 5px;
  border: 1px solid #eeeeee;
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
  border-bottom-right-radius: 5px;
  border-bottom-left-radius: 5px;
}

div.indent5 {
  padding-left: 0ex;
}

a {
  color: var(--link-color);
  background-color: inherit;
  text-decoration: none;
  border: none;
  outline: none;
  cursor: pointer;
  transition: 0.3s;
  margin: 0px;
}

a[href]:hover {
  background-color: var(--button-hover-color);
  color: var(--primary-text-color);
}

a.active {
  font-weight: bold;
}

a:not([href]):not([tabindex]):focus,
a:not([href]):not([tabindex]):hover {
  cursor: default;
}

/* Mozilla-specific padding fix */
@-moz-document url-prefix() {
  .submenu {
    padding-top: 3px;
    margin-bottom: 1px;
  }
}

.execMessageAlice {
  margin-right: 10%;
}

.execMessageBob {
  margin-left: 10%;
}

.form-header {
  border: 1px solid var(--border-color);
  background-color: var(--menu-bg-color);
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 20px;
  font-family: monospace;
  border-radius: 0.3rem 0.3rem 0 0;
  padding: 0.3rem;
}

.form-body {
  border: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: 80px;
  font-family: monospace;
  padding: 0 0.3rem 0.3rem 0.3rem;
  margin-block-end: 0;
}

.form-error {
  border: 1px solid var(--border-color);
  background-color: var(--danger-color);
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 10px;
  font-family: monospace;
  border-radius: 0 0 0.3rem 0.3rem;
  padding: 0.2rem;
  margin-bottom: 0.3rem;
}

.form-footer {
  border: 1px solid var(--border-color);
  background-color: var(--menu-bg-color);
  display: flex;
  justify-content: flex-end;
  align-items: center;
  min-height: 20px;
  font-family: monospace;
  border-radius: 0 0 0.3rem 0.3rem;
  padding: 0.3rem;
  padding-right: 50px;
}

.tab {
  overflow: hidden;
  border: 1px solid var(--border-color);
  background-color: var(--menu-bg-color);
}

/* Style the buttons that are used to open the tab content */
.tab .title {
  float: left;
  padding: 10px;
}

.tab button {
  background-color: inherit;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 7px 10px;
  transition: 0.3s;
  opacity: 0.6;
  margin: 3px;
}

button.button {
  background-color: var(--button-bg-color);
  border: none;
  outline: none;
  cursor: pointer;
  padding: 5px 10px;
  transition: 0.3s;
  opacity: 0.7;
  color: var(--button-font-color);
  margin: 2px;
}

button.button:hover {
  background-color: var(--button-bg-color);
  opacity: 1;
}

.tab button:hover,
.tab button.active {
  background-color: var(--button-hover-color);
  opacity: 1;
}

/* Style the tab content */
.tabs {
  margin-bottom: 1rem;
  border: 1px solid var(--border-color);
}
.tabcontentalways {
  padding: 6px 12px;
  border-top: none;
}
.tabcontent {
  padding: 6px 12px;
  border-top: none;
}
.tabcontentshow {
  background-color: tabcontenshow-bg-color;
  display: block;
  padding: 6px 12px;
  border: 1px solid #cccccc;
  border-top: none;
}

.explorer_button {
  margin-top: 5px;
  margin-bottom: 5px;
}

.node_explorer_button {
  margin-top: 5px;
  margin-bottom: 5px;
}

.explorer_button,
.node_explorer_button,
.centertextbutton {
  text-decoration: none;
  color: var(--link-color);
  background-color: inherit;
  border: 1px solid var(--link-color);
  margin-right: 5px;
  margin-left: 5px;
  border-radius: 5px;
  line-height: 1.1rem;
  height: 30px;
  vertical-align: middle;
}

.extramarginbottom {
  margin-bottom: 5px;
}

.centertextbutton[onclick]:hover {
  background-color: #f1f1f1; /** intentionally always the same color */
  cursor: pointer;
}

.centertextbutton:not([onclick]):hover {
  cursor: default;
}
input[type='checkbox']:hover {
  cursor: pointer;
}

input[type='checkbox'] {
  margin-top: 2px;
  height: 20px;
  width: 20px;
}

input[type='text'] {
  margin: 2px;
}

#storageDiv {
}

#storageDivInternal {
  overflow: auto;
  max-height: 500px;
  padding-bottom: 10px;
}

#storageAddressesDiv {
  overflow: auto;
  max-height: 400px;
}

.recordList {
  border-collapse: collapse;
  margin: 2px;
}

.recordList th {
  color: #880000;
  border-collapse: collapse;
}

.recordList td {
  padding: 1px;
  border: 1px solid var(--primary-text-color);
  border-style: solid;
  vertical-align: top;
  padding: 5px;
}

.bytes {
  margin: 2px;
  max-width: 120px;
  display: inline-block;
  overflow: hidden;
  white-space: nowrap;
  color: var(--code-store-color);
  text-overflow: ellipsis;
  font-family: monospace;
}

.key {
  margin: 2px;
  width: 120px;
  display: inline-block;
  overflow: hidden;
  white-space: nowrap;
  color: var(--key-address-color);
  text-overflow: ellipsis;
  font-family: monospace;
}

.signature {
  margin: 2px;
  width: 120px;
  display: inline-block;
  overflow: hidden;
  white-space: nowrap;
  color: #44aaaa;
  text-overflow: ellipsis;
  font-family: monospace;
}

.address {
  margin: 2px;
  width: 120px;
  display: inline-block;
  overflow: hidden;
  white-space: nowrap;
  color: var(--key-address-color);
  text-overflow: ellipsis;
  font-family: monospace;
}

.timestamp {
  margin: 2px;
  display: inline-block;
  overflow: hidden;
  white-space: nowrap;
  color: var(--timestamp-color);
  text-overflow: ellipsis;
  font-family: monospace;
}

.mutez {
  margin: 2px;
  display: inline-block;
  overflow: hidden;
  white-space: nowrap;
  color: #66aa00;
  text-overflow: ellipsis;
  font-family: monospace;
}

#contractId {
  width: 300px;
  font-family: monospace;
}

#accountId {
  width: 300px;
  font-family: monospace;
}

#providerId {
  width: 300px;
  font-family: monospace;
}

.preview {
  min-height: 100px;
  overflow: scroll;
  border: 1px solid black;
  font-family: monospace;
  border-radius: 0.3rem;
  padding: 0.3rem;
}

.protocolBox {
  border: 1px solid #ccc;
  padding: 2px;
  margin-top: 2px;
  margin-bottom: 2px;
  border-radius: 5px;
}

.input-error {
  color: var(--danger-color);
  text-align: center;
}

.load-contract {
  display: flex;
  flex-direction: column;
  margin-bottom: 2px;
}

.load-contract button {
  margin: 0.3rem 0;
  padding: 0.3rem 0.5rem;
  align-self: flex-start;
}

@media (max-width: 568px) {
  #help,
  #explorer,
  #node_explorer,
  #faucet,
  #origination,
  #faq,
  #wallet {
    margin: 1rem 0.5rem;
  }
  .right-submenu {
    padding-left: 0.5rem;
    border-left: none;
  }
  .spacer {
    width: 5rem;
  }
}

span.fieldName {
  display: inline-block;
  color: #444488;
  min-width: 100px;
}

/**
    * Code Highlighting
    **/
span.channel {
  color: #8888ff;
}

span.type {
  color: var(--code-type-color);
}

span.partialType {
  color: #ff4444;
}

span.variable {
  color: var(--code-variable-color);
}

span.store {
  color: var(--code-store-color);
}

span.param {
  color: #888800;
}

span.variable {
  color: #008800;
}

span.keyword {
  color: #bb4488;
}

span.conditions {
  color: #55aa55;
}

span.constant {
  color: var(--code-constant-color);
}

span.cons {
  color: #0000aa;
}

span.record {
  color: #4288aa;
}

span.conditions span {
  color: #55aa55;
}

span.gas {
  color: orange;
}

span.analysis {
  color: orange;
}

span.self {
  color: #0099aa;
}

span.comment {
  color: var(--code-comment-color);
}

span.stack {
  color: #0088aa;
}

span.ctt {
  color: lightblue;
}

code,
span.command {
  background-color: hsla(0, 0%, 0%, 0.04);
  color: #444488;
}

/* Ledger */
.ledger-icon {
  height: 20px;
  margin-top: 5px;
  background-repeat: no-repeat;
}

/* Wallet Styles */
.applied-op-bg {
  background-color: var(--applied-op-color);
}

.failed-op-bg {
  background-color: var(--failed-op-color);
}

.inputSection {
  display: flex;
  justify-content: space-between;
  align-content: space-between;
  align-items: center;
  width: 300px;
}

select {
  font-size: 16px;
  font-family: sans-serif;
  color: #444;
  line-height: 1.3;
  padding: 0.3em 2em 0.2em 0.8em;
  box-sizing: border-box;
  margin: 5px;
  border: 1px solid #aaa;
  box-shadow: 0 1px 0 1px rgba(0, 0, 0, 0.04);
  border-radius: 0.5em;
  -moz-appearance: none;
  -webkit-appearance: none;
  appearance: none;
  background-color: #fff;
  background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23007CB2%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'),
    linear-gradient(to bottom, #ffffff 0%, #e5e5e5 100%);
  background-repeat: no-repeat, repeat;
  /* arrow icon position (1em from the right, 50% vertical) , then gradient position*/
  background-position: right 0.7em top 50%, 0 0;
  /* icon size, then gradient */
  background-size: 0.65em auto, 100%;
}
.select::-ms-expand {
  display: none;
}
.select:hover {
  border-color: #888;
}
.select:focus {
  border-color: #aaa;
  box-shadow: 0 0 1px 3px rgba(59, 153, 252, 0.7);
  box-shadow: 0 0 0 3px -moz-mac-focusring;
  color: #222;
  outline: none;
}
.select option {
  font-weight: normal;
}
.select:disabled:hover,
select[aria-disabled='true'] {
  border-color: #aaa;
}

.loader {
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid #3498db;
  width: 120px;
  height: 120px;
  -webkit-animation: spin 2s linear infinite; /* Safari */
  animation: spin 2s linear infinite;
  margin: auto;
  margin-bottom: 20px;
}

/* Beacon & Temple Styles */
.flexRow {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  align-content: center;
  background-color: var(--button-hover-color);
  padding: 10px;
}

/* Safari */
@-webkit-keyframes spin {
  0% {
    -webkit-transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
  }
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
/* latin-ext */
@font-face {
  font-family: 'Lato';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/lato/v16/S6uyw4BMUTPHjxAwXiWtFCfQ7A.woff2)
    format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB,
    U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

/* latin-ext */
@font-face {
  font-family: 'Lato';
  font-style: normal;
  font-weight: 700;
  src: url(https://fonts.gstatic.com/s/lato/v16/S6u9w4BMUTPHh6UVSwaPGQ3q5d0N7w.woff2)
    format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB,
    U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
/* latin */
@font-face {
  font-family: 'Lato';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/lato/v16/S6uyw4BMUTPHjx4wXiWtFCc.woff2)
    format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6,
    U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191,
    U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
/* latin */
@font-face {
  font-family: 'Lato';
  font-style: normal;
  font-weight: 700;
  src: url(https://fonts.gstatic.com/s/lato/v16/S6u9w4BMUTPHh6UVSwiPGQ3q5d0.woff2)
    format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6,
    U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191,
    U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

html,
body {
  font-size: 16px;
  font-family: Lato, sans-serif;
  font-weight: 400;
}

h1,
h2,
h3,
h4,
p,
li {
  margin-left: 0;
  margin-right: 0;
  margin-top: 0;
  padding-bottom: 0;
  padding-left: 0;
  padding-right: 0;
  padding-top: 0;
}

li {
  margin-bottom: 0.5rem;
}

h1,
h2,
h3,
h4 {
  /* color: hsla(0, 0%, 0%, 0.8); */
  font-family: Lato, sans-serif;
  font-weight: 700;
  text-rendering: optimizeLegibility;
}

h1 {
  font-size: 2rem;
  line-height: 2.415rem;
}

h2 {
  font-size: 1.51572rem;
  line-height: 2.415rem;
}

h3 {
  font-size: 1.31951rem;
  line-height: 1.61rem;
}

h4 {
  font-size: 1rem;
}

td.pad10 {
  padding-left: 10px;
  padding-right: 10px;
}

td.code_right {
  text-align: right;
  font-family: monospace;
}

code,
span.command {
  font-size: 0.88rem;
  line-height: 1.61rem;

  border-radius: 3px;
  font-family: monospace;
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
}

.page-title {
  text-align: center;
  margin: 1rem 0 2.5rem 0;
}

/**
  * Output Typography
  **/
#outputPanel .execMessage *,
#outputPanel .tabcontent *,
#types {
  font-size: 0.9375rem;
  line-height: 1.1em;
}

#outputPanel .execMessage h1,
#outputPanel .tabcontent h1 {
  font-size: 1.5rem;
  font-weight: normal;
  margin-bottom: 0;
}

#outputPanel .execMessage h2,
#outputPanel .tabcontent h2 {
  font-size: 1.3rem;
  font-weight: normal;
  margin-bottom: 0.2em;
}

#outputPanel .execMessage h3,
#outputPanel .tabcontent h3 {
  font-size: 1.1rem;
  font-weight: normal;
  margin-bottom: 0.2em;
}

#outputPanel .execMessage h4,
#outputPanel .tabcontent h4 {
  font-size: 1rem;
  font-weight: normal;
  margin-bottom: 0.2em;
}

#types .type,
#outputPanel .type,
.python,
#outputPanel .python,
.michelson,
#outputPanel .michelson,
#outputPanel .on {
  font-family: monospace;
  font-size: 0.9375rem;
}

.dataColumn,
.code {
  font-family: monospace;
}
button{font-size:inherit;}</style><script src='https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js'></script><script>// Copyright 2022-2023 Morum LLC, 2019-2022 Smart Chain Arena LLC

function copyMichelson(x) {
  var range = document.createRange();
  var children = x.parentNode.parentNode.childNodes;
  children.forEach(function (child) {
    if (child.nodeType != Node.TEXT_NODE) {
      if (child.className.includes('michelson')) {
        range.selectNode(child);
        console.log(child);
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(range);
        document.execCommand('copy');
      }
    }
  });
}

function openTabLazy(evt, id, global_id) {
  var i, tabcontent, tablinks;

  tabcontent = evt.currentTarget.parentNode.parentNode.childNodes;
  for (i = 0; i < tabcontent.length; i++) {
    if (tabcontent[i].className == 'tabcontent')
      tabcontent[i].style.display = 'none';
  }
  tablinks = evt.currentTarget.parentNode.childNodes;
  for (i = 0; i < tablinks.length; i++) {
    if (tablinks[i].nodeType != Node.TEXT_NODE) {
      tablinks[i].className = tablinks[i].className.replace(
        ' active',
        ''
      );
    }
  }
  tablinks = evt.currentTarget.parentNode.parentNode.childNodes;
  k = 0;
  for (i = 0; i < tablinks.length; i++) {
    if (tablinks[i].nodeType != Node.TEXT_NODE) {
      if (id + 1 == k) {
        tablinks[i].style.display = 'block';
        lazy_tab = window.smartmlCtx.call_exn_handler(
          'lazy_tab',
          id,
          global_id
        );
        if (lazy_tab) tablinks[i].innerHTML = lazy_tab;
      }
      k += 1;
    }
  }

  evt.currentTarget.className += ' active';
}

function openTab(evt, name) {
  var i, tabcontent, tablinks;

  tabcontent = evt.currentTarget.parentNode.parentNode.childNodes;
  for (i = 0; i < tabcontent.length; i++) {
    if (tabcontent[i].className == 'tabcontent')
      tabcontent[i].style.display = 'none';
  }
  tablinks = evt.currentTarget.parentNode.childNodes;
  for (i = 0; i < tablinks.length; i++) {
    if (tablinks[i].nodeType != Node.TEXT_NODE) {
      tablinks[i].className = tablinks[i].className.replace(
        ' active',
        ''
      );
    }
  }
  tablinks = evt.currentTarget.parentNode.parentNode.childNodes;
  k = 0;
  for (i = 0; i < tablinks.length; i++) {
    if (tablinks[i].nodeType != Node.TEXT_NODE) {
      if (name + 1 == k) tablinks[i].style.display = 'block';
      k += 1;
    }
  }

  evt.currentTarget.className += ' active';
}

class SmartmlCtx {
  constructor() {}
  call(f, ...rest) {
    try {
      return exports[f](...rest);
    } catch (error) {
      var result = 0;
      try {
        result = this.call('stringOfException', true, error);
      } catch (_error) {
        throw error;
      }
      if (
        typeof window.toException === 'function' &&
        !window.location.pathname.includes('ts-ide')
      )
        throw toException(result);
      else throw result;
    }
  }
  call_exn(f, ...rest) {
    return exports[f](...rest);
  }
  call_exn_handler(f, ...rest) {
    try {
      return exports[f](...rest);
    } catch (error) {
      try {
        var result = '';
        try {
          result = this.call('stringOfException', false, error);
        } catch (_error) {
          showErrorPre(error);
        }
        console.log(result);
        showErrorPre(result);
      } catch (_error) {
        showErrorPre(error);
      }
    }
  }
}

smartmlCtx = new SmartmlCtx();
in_browser = true;
// Copyright 2022-2023 Morum LLC, 2019-2022 Smart Chain Arena LLC

/** Set light/dark mode based on user preferences */
$(document).ready(() => {
  if (window) {
    setThemeClass(window.localStorage.getItem('theme', 'light'));
  }
});

// Define a new stylesheet for the theme's custom rules
const sheet = (function () {
  // Create the <style> tag
  const style = document.createElement('style');

  // WebKit hack :(
  style.appendChild(document.createTextNode(''));

  // Add the <style> element to the page
  document.head.appendChild(style);

  return style.sheet;
})();

// Replace non-root rules in custom stylesheet
const replaceRules = (rules) => {
  for (let i = 0; i < sheet.rules.length; i++) {
    sheet.deleteRule(i);
  }
  sheet.insertRule(`@media all {${rules}}`);
};

const activateDarkMode = () => {
  const rootElement = document.querySelector(':root');
  const darkTheme = {
    '--primary': '#006dcc',
    '--primary-text-color': '#fafafa',

    '--background-color': '#212529',
    '--link-color': '#66AACC',
    '--button-hover-color': 'slategray',
    '--menu-bg-color': '#05385C',
    '--border-color': '#D3D3D3',

    '--output-bgok': '#05364a',
    '--output-bgko': '#4a3605',

    '--danger-color': '#dc3545',
    '--dataColumn-color': 'blanchedalmond',
    '--simulationBuilder-bg-color': '#444488',
    '--tabcontentshow-bg-color': 'darkgreen',

    '--key-address-color': 'chocolate',
    '--timestamp-color': 'aqua',
    '--code-type-color': 'magenta',
    '--code-variable-color': 'khaki',
    '--code-store-color': 'greenyellow',
    '--code-constant-color': 'red',
    '--code-cons-color': 'hotpink',
    '--code-comment-color': 'chocolate',

    '--button-bg-color': '#FFF',
    '--button-font-color': '#000',

    /* Wallet colors */
    '--applied-op-color': '#94b84d',
    '--failed-op-color': '#d16864',
  };

  const darkRules = `
    button.editor-menu-btn:not([disabled]):hover {
        color: var(--background-color);
        background-color: #e8e8e8;
    }

    .right-submenu button,
    .pretty-submenu button {
        background-color: var(--primary-text-color);
    }

    #outputPanel.empty-output {
        background: rgba(30, 30, 30, .8) url(logo-transp.png) center/40% no-repeat;
        background-blend-mode: color;
    }

    #logo-image {
        background: url(dm-logo.png) left/75% no-repeat;
    }

    .modal-content {
        background-color: var(--menu-bg-color);
    }

    /** XXX: url of svgs is different here than from stylesheet */
    #editor-link {
        background-image: url(./svgs/dm-terminal.svg);
    }

    #wallet-link {
        background-image: url(./svgs/wallet-light.svg);
    }

    #faucet-link {
        background-image: url(./svgs/dm-faucet.svg);
    }

    #explorer-link {
        background-image: url(./svgs/dm-search.svg);
    }

    #node_explorer-link {
        background-image: url(./svgs/dm-search.svg);
    }

    #michelson-link {
        background-image: url(./svgs/dm-stream.svg);
    }

    #origination-link {
        background-image: url(./svgs/dm-stream.svg);
    }

    #help-link {
        background-image: url(./svgs/dm-question.svg);
    }

    #ledger-img {
        background-image: url(./svgs/ledger-light.svg);
        background-repeat: no-repeat;
    }
    `;

  for (let k in darkTheme) {
    rootElement.style.setProperty(k, darkTheme[k]);
  }

  replaceRules(darkRules);
};

const activateLightMode = () => {
  const rootElement = document.querySelector(':root');
  const lightTheme = {
    '--primary': '#006dcc',
    '--primary-text-color': '#212529',

    '--background-color': '#fafafa',
    '--link-color': '#01608C',
    '--button-hover-color': '#e8e8e8',
    '--menu-bg-color': '#f1f1f1',
    '--border-color': '#D3D3D3',

    '--output-bgok': '#f1f1fa',
    '--output-bgko': '#faf1f1',

    '--danger-color': '#dc3545',
    '--dataColumn-color': '#290075',
    '--simulationBuilder-bg-color': '#f0fde1',
    '--tabcontentshow-bg-color': '#ccffcc',

    '--key-address-color': '#006600',
    '--timestamp-color': '#6600AA',
    '--code-type-color': '#331188',
    '--code-variable-color': '#aa0000',
    '--code-store-color': '#0000aa',
    '--code-constant-color': '#000088',
    '--code-cons-color': '#0000aa',
    '--code-comment-color': '#006600',

    '--button-bg-color': '#006dcc',
    '--button-font-color': '#FFF',

    /* Wallet colors */
    '--applied-op-color': '#e8ffc2',
    '--failed-op-color': '#ffcfbf',
  };

  const lightRules = `button.editor-menu-btn:not([disabled]):hover {
        color: var(--primary-text-color);
        background-color: var(--background-color);
    }

    .right-submenu button,
    .pretty-submenu button {
        background-color: inherit;
    }

    #outputPanel.empty-output {
        background: rgba(255, 255, 255, .9) url(smartPY.only.transp.png) center/40% no-repeat;
        background-blend-mode: color;
    }

    #logo-image {
        background: url(smartPY_horizon.transp.png) left/75% no-repeat;
    }

    .modal-content {
        background-color: #fff;
    }

    /** XXX: url of svgs is different here than from stylesheet */
    #editor-link {
        background-image: url(./svgs/terminal.svg);
    }

    #wallet-link {
        background-image: url(./svgs/wallet-dark.svg);
    }

    #faucet-link {
        background-image: url(./svgs/faucet.svg);
    }

    #explorer-link {
        background-image: url(./svgs/search.svg);
    }

    #node_explorer-link {
        background-image: url(./svgs/search.svg);
    }

    #michelson-link {
        background-image: url(./svgs/stream.svg);
    }

    #origination-link {
        background-image: url(./svgs/stream.svg);
    }

    #help-link {
        background-image: url(./svgs/question.svg);
    }

    #ledger-img {
        background-image: url(./svgs/ledger-dark.svg);
        background-repeat: no-repeat;
    }
    `;

  for (let k in lightTheme) {
    rootElement.style.setProperty(k, lightTheme[k]);
  }

  replaceRules(lightRules);
};

const setThemeClass = (theme) => {
  if (theme === 'dark') {
    activateDarkMode();
  } else {
    activateLightMode();
  }
};
</script></head><body><div id='outputPanel'><div class='contract'><h3>Balance: 0.000000<img height=20 width=20 src='https://SmartPy.io/static/img/tezos.svg' alt='tz'/></h3>
<h3>Storage:</h3>
<div id='storageDivInternal'><table class='recordList'><tr><td class='dataColumn'>AccBorrowBalance</td>
<td class='dataColumn'>AccCTokenBalance</td>
<td class='dataColumn'>AccExchangeRateMantissa</td>
<td class='dataColumn'>AccrualBlockNumber</td>
<td class='dataColumn'>ActiveOperations</td>
<td class='dataColumn'>Administrator</td>
<td class='dataColumn'>BorrowIndex</td>
<td class='dataColumn'>BorrowRateMaxMantissa</td>
<td class='dataColumn'>BorrowRatePerBlock</td>
<td class='dataColumn'>Borrows</td>
<td class='dataColumn'>Comptroller</td>
<td class='dataColumn'>ExpScale</td>
<td class='dataColumn'>HalfExpScale</td>
<td class='dataColumn'>InitialExchangeRateMantissa</td>
<td class='dataColumn'>InterestRateModel</td>
<td class='dataColumn'>Ledger</td>
<td class='dataColumn'>Metadata</td>
<td class='dataColumn'>PendingAdministrator</td>
<td class='dataColumn'>ProtocolSeizeShareMantissa</td>
<td class='dataColumn'>ReserveFactorMantissa</td>
<td class='dataColumn'>ReserveFactorMaxMantissa</td>
<td class='dataColumn'>SupplyRatePerBlock</td>
<td class='dataColumn'>Token_metadata</td>
<td class='dataColumn'>TotalBorrows</td>
<td class='dataColumn'>TotalReserves</td>
<td class='dataColumn'>TotalSupply</td></tr><tr><td class='data'><input type='text' value='0' readonly></input></td><td class='data'><input type='text' value='0' readonly></input></td><td class='data'><input type='text' value='0' readonly></input></td><td class='data'><input type='text' value='0' readonly></input></td><td class='data'></td><td class='data'><span class='address'>tz1UyQDepgtUBnWjyzzonqeDwaiWoQzRKSP5</span></td><td class='data'><input type='text' value='1000000000000000000' readonly></input></td><td class='data'><input type='text' value='800000000000' readonly></input></td><td class='data'><input type='text' value='0' readonly></input></td><td class='data'><table class='recordList'><tr><td class='dataColumn'>Key</td>
<td class='dataColumn'>InterestIndex</td>
<td class='dataColumn'>Principal</td></tr></table></td><td class='data'><span class='address'>KT1Tezooo1zzSmartPyzzSTATiCzzzyfC8eF</span></td><td class='data'><input type='text' value='1000000000000000000' readonly></input></td><td class='data'><input type='text' value='500000000000000000' readonly></input></td><td class='data'><input type='text' value='1000000000000' readonly></input></td><td class='data'><span class='address'>KT1Tezooo2zzSmartPyzzSTATiCzzzwqqQ4H</span></td><td class='data'><table class='recordList'><tr><td class='dataColumn'>Key</td>
<td class='dataColumn'>Approvals</td>
<td class='dataColumn'>Balance</td></tr></table></td><td class='data'><table class='recordList'><tr><td class='dataColumn'>Key</td>
<td class='dataColumn'>Value</td></tr><tr><td class='data'>''</td><td class='data'><span class='bytes'>0x74657a6f732d73746f726167653a64617461</span></td></tr>
<tr><td class='data'>'data'</td><td class='data'><span class='bytes'>0x7b226e616d65223a20222e2e2e222c20226465736372697074696f6e223a20222e2e2e222c202276657273696f6e223a2022312e302e30222c2022617574686f7273223a205b22657771656e716a77225d2c2022686f6d6570616765223a202268747470733a2f2f736f6d652d776562736974652e636f6d222c2022696e7465726661636573223a205b22545a49502d303037225d2c20226c6963656e7365223a207b226e616d65223a20222e2e2e227d7d</span></td></tr></table></td><td class='data'><div class='subtype'><select class='selection'><option value='None'>None</option></select></div></td><td class='data'><input type='text' value='100000000000000' readonly></input></td><td class='data'><input type='text' value='50000000000000000' readonly></input></td><td class='data'><input type='text' value='1000000000000000000' readonly></input></td><td class='data'><input type='text' value='0' readonly></input></td><td class='data'><table class='recordList'><tr><td class='dataColumn'>Key</td>
<td class='dataColumn'>Token_id</td>
<td class='dataColumn'>Token_info</td></tr><tr><td class='data'><input type='text' value='0' readonly></input></td><td class='data'><input type='text' value='0' readonly></input></td><td class='data'><table class='recordList'><tr><td class='dataColumn'>Key</td>
<td class='dataColumn'>Value</td></tr><tr><td class='data'>'decimals'</td><td class='data'><span class='bytes'>0x78</span></td></tr>
<tr><td class='data'>'name'</td><td class='data'><span class='bytes'>0x436f6d706f756e6420746f6b656e</span></td></tr>
<tr><td class='data'>'symbol'</td><td class='data'><span class='bytes'>0x63546f6b656e</span></td></tr></table></td></tr></table></td><td class='data'><input type='text' value='0' readonly></input></td><td class='data'><input type='text' value='0' readonly></input></td><td class='data'><input type='text' value='0' readonly></input></td></tr></table></div>
<h3>Code:</h3>
import smartpy as sp
<br>
<br>class Contract(sp.Contract):
<br><div class='on'><span class='keyword'>def</span> __init__(self)<span class='keyword'>:</span><div class='indent5'>&nbsp;&nbsp;self.init_type(sp.TRecord(accBorrowBalance = sp.TNat, accCTokenBalance = sp.TNat, accExchangeRateMantissa = sp.TNat, accrualBlockNumber = sp.TNat, activeOperations = sp.TSet(sp.TNat), administrator = sp.TAddress, borrowIndex = sp.TNat, borrowRateMaxMantissa = sp.TNat, borrowRatePerBlock = sp.TNat, borrows = sp.TBigMap(sp.TAddress, sp.TRecord(interestIndex = sp.TNat, principal = sp.TNat).layout(("interestIndex", "principal"))), comptroller = sp.TAddress, expScale = sp.TNat, halfExpScale = sp.TNat, initialExchangeRateMantissa = sp.TNat, interestRateModel = sp.TAddress, ledger = sp.TBigMap(sp.TAddress, sp.TRecord(approvals = sp.TMap(sp.TAddress, sp.TNat), balance = sp.TNat).layout(("approvals", "balance"))), metadata = sp.TBigMap(sp.TString, sp.TBytes), pendingAdministrator = sp.TOption(sp.TAddress), protocolSeizeShareMantissa = sp.TNat, reserveFactorMantissa = sp.TNat, reserveFactorMaxMantissa = sp.TNat, supplyRatePerBlock = sp.TNat, token_metadata = sp.TBigMap(sp.TNat, sp.TRecord(token_id = sp.TNat, token_info = sp.TMap(sp.TString, sp.TBytes)).layout(("token_id", "token_info"))), totalBorrows = sp.TNat, totalReserves = sp.TNat, totalSupply = sp.TNat).layout((((("accBorrowBalance", ("accCTokenBalance", "accExchangeRateMantissa")), ("accrualBlockNumber", ("activeOperations", "administrator"))), (("borrowIndex", ("borrowRateMaxMantissa", "borrowRatePerBlock")), (("borrows", "comptroller"), ("expScale", "halfExpScale")))), ((("initialExchangeRateMantissa", ("interestRateModel", "ledger")), ("metadata", ("pendingAdministrator", "protocolSeizeShareMantissa"))), (("reserveFactorMantissa", ("reserveFactorMaxMantissa", "supplyRatePerBlock")), (("token_metadata", "totalBorrows"), ("totalReserves", "totalSupply")))))))</div>
<div class='indent5'>&nbsp;&nbsp;self.init(<span class='variable'>accBorrowBalance</span> = 0,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>accCTokenBalance</span> = 0,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>accExchangeRateMantissa</span> = 0,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>accrualBlockNumber</span> = 0,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>activeOperations</span> = sp.set([]),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>administrator</span> = sp.address('tz1UyQDepgtUBnWjyzzonqeDwaiWoQzRKSP5'),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>borrowIndex</span> = 1000000000000000000,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>borrowRateMaxMantissa</span> = 800000000000,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>borrowRatePerBlock</span> = 0,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>borrows</span> = {},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>comptroller</span> = sp.address('KT1Tezooo1zzSmartPyzzSTATiCzzzyfC8eF'),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>expScale</span> = 1000000000000000000,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>halfExpScale</span> = 500000000000000000,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>initialExchangeRateMantissa</span> = 1000000000000,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>interestRateModel</span> = sp.address('KT1Tezooo2zzSmartPyzzSTATiCzzzwqqQ4H'),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>ledger</span> = {},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>metadata</span> = {'' : sp.bytes('0x74657a6f732d73746f726167653a64617461'), 'data' : sp.bytes('0x7b226e616d65223a20222e2e2e222c20226465736372697074696f6e223a20222e2e2e222c202276657273696f6e223a2022312e302e30222c2022617574686f7273223a205b22657771656e716a77225d2c2022686f6d6570616765223a202268747470733a2f2f736f6d652d776562736974652e636f6d222c2022696e7465726661636573223a205b22545a49502d303037225d2c20226c6963656e7365223a207b226e616d65223a20222e2e2e227d7d')},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>pendingAdministrator</span> = sp.none,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>protocolSeizeShareMantissa</span> = 100000000000000,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>reserveFactorMantissa</span> = 50000000000000000,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>reserveFactorMaxMantissa</span> = 1000000000000000000,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>supplyRatePerBlock</span> = 0,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>token_metadata</span> = {0 : sp.record(token_id = 0, token_info = {'decimals' : sp.bytes('0x78'), 'name' : sp.bytes('0x436f6d706f756e6420746f6b656e'), 'symbol' : sp.bytes('0x63546f6b656e')})},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>totalBorrows</span> = 0,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>totalReserves</span> = 0,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='variable'>totalSupply</span> = 0)</div></div><br>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> acceptGovernance(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TUnit)
<br>&nbsp;&nbsp;sp.verify(sp.sender == <span class='self'>self</span>.data.pendingAdministrator.open_some(message = <span class='constant'>'CT_NOT_SET_PENDING_ADMIN'</span>), <span class='constant'>'CT_NOT_PENDING_ADMIN'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.administrator = <span class='self'>self</span>.data.pendingAdministrator.open_some()
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.pendingAdministrator = sp.none</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> accrueInterest(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TUnit)
<br>&nbsp;&nbsp;sp.if sp.level != <span class='self'>self</span>.data.accrualBlockNumber:
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.accrualBlockNumber == <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.accrualBlockNumber = sp.level
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.else:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.activeOperations.add(<span class='constant'>8</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.transfer(sp.self_entrypoint('doAccrueInterest'), <span class='constant'>sp.tez(0)</span>, sp.contract(sp.TContract(sp.TNat), sp.self_address, entrypoint='accrueInterestInternal').open_some())</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> accrueInterestInternal(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TContract(sp.TNat))
<br>&nbsp;&nbsp;sp.verify(sp.sender == sp.self_address, <span class='constant'>'CT_INTERNAL_FUNCTION'</span>)
<br>&nbsp;&nbsp;sp.transfer(sp.record(borrows = <span class='self'>self</span>.data.totalBorrows, cash = <span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>, cb = params, reserves = <span class='self'>self</span>.data.totalReserves), <span class='constant'>sp.tez(0)</span>, sp.contract(sp.TRecord(borrows = sp.TNat, cash = sp.TNat, cb = sp.TContract(sp.TNat), reserves = sp.TNat).layout((("borrows", "cash"), ("cb", "reserves"))), <span class='self'>self</span>.data.interestRateModel, entrypoint='getBorrowRate').open_some())</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> addReserves(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;sp.verify(sp.sender != sp.self_address, <span class='constant'>'CT_INTERNAL_CALL'</span>)
<br>&nbsp;&nbsp;sp.verify(sp.len(<span class='self'>self</span>.data.activeOperations) == <span class='constant'>0</span>, <span class='constant'>'OP_IN_PROGRESS'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.activeOperations.add(<span class='constant'>11</span>)
<br>&nbsp;&nbsp;sp.transfer(<span class='constant'>sp.unit</span>, <span class='constant'>sp.tez(0)</span>, sp.self_entrypoint('accrueInterest'))
<br>&nbsp;&nbsp;sp.transfer(sp.record(addAmount = params, originalSender = sp.sender), sp.amount, sp.self_entrypoint('addReservesInternal'))</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> addReservesInternal(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.verify(sp.sender == sp.self_address, <span class='constant'>'CT_INTERNAL_FUNCTION'</span>)
<br>&nbsp;&nbsp;sp.verify(<span class='self'>self</span>.data.activeOperations.contains(<span class='constant'>11</span>), <span class='constant'>'OP_NOT_ACTIVE'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.activeOperations.remove(<span class='constant'>11</span>)
<br>&nbsp;&nbsp;sp.verify(sp.level == <span class='self'>self</span>.data.accrualBlockNumber, <span class='constant'>'CT_INTEREST_OLD'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.totalReserves += params.addAmount</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> approve(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TRecord(spender = sp.TAddress, value = sp.TNat).layout(("spender", "value")))
<br>&nbsp;&nbsp;sp.verify(sp.sender != sp.self_address, <span class='constant'>'CT_INTERNAL_CALL'</span>)
<br>&nbsp;&nbsp;sp.verify((<span class='self'>self</span>.data.ledger[sp.sender].approvals.contains(params.spender)) | (sp.len(<span class='self'>self</span>.data.ledger[sp.sender].approvals) < <span class='constant'>1000</span>), <span class='constant'>'FA1.2_MaxApprovalsReached'</span>)
<br>&nbsp;&nbsp;sp.verify((<span class='self'>self</span>.data.ledger[sp.sender].approvals.get(params.spender, default_value = <span class='constant'>0</span>) == <span class='constant'>0</span>) | (params.value == <span class='constant'>0</span>), <span class='constant'>'FA1.2_UnsafeAllowanceChange'</span>)
<br>&nbsp;&nbsp;sp.if params.value == <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='keyword'>del</span> <span class='self'>self</span>.data.ledger[sp.sender].approvals[params.spender]
<br>&nbsp;&nbsp;sp.else:
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.ledger[sp.sender].approvals[params.spender] = params.value</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> borrow(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;sp.verify(sp.sender != sp.self_address, <span class='constant'>'CT_INTERNAL_CALL'</span>)
<br>&nbsp;&nbsp;sp.if ~ (<span class='self'>self</span>.data.ledger.contains(sp.sender)):
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.ledger[sp.sender] = sp.record(approvals = {}, balance = <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.if ~ (<span class='self'>self</span>.data.borrows.contains(sp.sender)):
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.borrows[sp.sender] = sp.record(interestIndex = <span class='constant'>0</span>, principal = <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.transfer(sp.record(borrowAmount = params, borrower = sp.sender, cToken = sp.self_address), <span class='constant'>sp.tez(0)</span>, sp.contract(sp.TRecord(borrowAmount = sp.TNat, borrower = sp.TAddress, cToken = sp.TAddress).layout(("cToken", ("borrower", "borrowAmount"))), <span class='self'>self</span>.data.comptroller, entrypoint='borrowAllowed').open_some())
<br>&nbsp;&nbsp;sp.verify((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) >= params, <span class='constant'>'CT_INSUFFICIENT_CASH'</span>)
<br>&nbsp;&nbsp;sp.verify(sp.level == <span class='self'>self</span>.data.accrualBlockNumber, <span class='constant'>'CT_INTEREST_OLD'</span>)
<br>&nbsp;&nbsp;<span class='local'>borrowBalance</span> = sp.local("<span class='local'>borrowBalance</span>", <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.borrows.contains(sp.sender):
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>borrowSnapshot</span> = sp.local("<span class='local'>borrowSnapshot</span>", <span class='self'>self</span>.data.borrows[sp.sender])
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if borrowSnapshot.value.principal > <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;borrowBalance.value = (borrowSnapshot.value.principal * <span class='self'>self</span>.data.borrowIndex) // borrowSnapshot.value.interestIndex
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.borrows[sp.sender].principal = borrowBalance.value + params
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.borrows[sp.sender].interestIndex = <span class='self'>self</span>.data.borrowIndex
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.totalBorrows += params</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> borrowBalanceStored(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;__s1 = sp.bind_block("__s1"):
<br>&nbsp;&nbsp;with __s1:
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.fst(params), sp.TAddress)
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>borrowBalance</span> = sp.local("<span class='local'>borrowBalance</span>", <span class='constant'>0</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.borrows.contains(sp.fst(params)):
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>borrowSnapshot</span> = sp.local("<span class='local'>borrowSnapshot</span>", <span class='self'>self</span>.data.borrows[sp.fst(params)])
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.if borrowSnapshot.value.principal > <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;borrowBalance.value = (borrowSnapshot.value.principal * <span class='self'>self</span>.data.borrowIndex) // borrowSnapshot.value.interestIndex
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.result(borrowBalance.value)
<br>&nbsp;&nbsp;sp.set_type(sp.snd(params), sp.TContract(sp.TNat))
<br>&nbsp;&nbsp;sp.transfer(__s1.value, <span class='constant'>sp.tez(0)</span>, sp.snd(params))</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> doAccrueInterest(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;sp.verify(sp.sender == <span class='self'>self</span>.data.interestRateModel, <span class='constant'>'CT_SENDER_NOT_IRM'</span>)
<br>&nbsp;&nbsp;sp.verify(<span class='self'>self</span>.data.activeOperations.contains(<span class='constant'>8</span>), <span class='constant'>'OP_NOT_ACTIVE'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.activeOperations.remove(<span class='constant'>8</span>)
<br>&nbsp;&nbsp;sp.verify(params <= <span class='self'>self</span>.data.borrowRateMaxMantissa, <span class='constant'>'CT_INVALID_BORROW_RATE'</span>)
<br>&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(sp.record(mantissa = params), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;sp.set_type(sp.as_nat(sp.level - <span class='self'>self</span>.data.accrualBlockNumber), sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(params * sp.as_nat(sp.level - <span class='self'>self</span>.data.accrualBlockNumber), sp.TNat)
<br>&nbsp;&nbsp;<span class='local'>compute_CToken_761</span> = sp.local("<span class='local'>compute_CToken_761</span>", sp.record(mantissa = params * sp.as_nat(sp.level - <span class='self'>self</span>.data.accrualBlockNumber)))
<br>&nbsp;&nbsp;sp.set_type(compute_CToken_761.value, sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;sp.set_type(compute_CToken_761.value, sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalBorrows, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(compute_CToken_761.value.mantissa * <span class='self'>self</span>.data.totalBorrows, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(sp.record(mantissa = compute_CToken_761.value.mantissa * <span class='self'>self</span>.data.totalBorrows), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;<span class='local'>compute_CToken_763</span> = sp.local("<span class='local'>compute_CToken_763</span>", (compute_CToken_761.value.mantissa * <span class='self'>self</span>.data.totalBorrows) // <span class='self'>self</span>.data.expScale)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.totalBorrows = compute_CToken_763.value + <span class='self'>self</span>.data.totalBorrows
<br>&nbsp;&nbsp;sp.set_type(sp.record(mantissa = <span class='self'>self</span>.data.reserveFactorMantissa), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;sp.set_type(compute_CToken_763.value, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalReserves, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(sp.record(mantissa = <span class='self'>self</span>.data.reserveFactorMantissa), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;sp.set_type(sp.record(mantissa = <span class='self'>self</span>.data.reserveFactorMantissa), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;sp.set_type(compute_CToken_763.value, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.reserveFactorMantissa * compute_CToken_763.value, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(sp.record(mantissa = <span class='self'>self</span>.data.reserveFactorMantissa * compute_CToken_763.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.totalReserves = ((<span class='self'>self</span>.data.reserveFactorMantissa * compute_CToken_763.value) // <span class='self'>self</span>.data.expScale) + <span class='self'>self</span>.data.totalReserves
<br>&nbsp;&nbsp;sp.set_type(compute_CToken_761.value, sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.borrowIndex, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.borrowIndex, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(compute_CToken_761.value, sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;sp.set_type(compute_CToken_761.value, sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.borrowIndex, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(compute_CToken_761.value.mantissa * <span class='self'>self</span>.data.borrowIndex, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(sp.record(mantissa = compute_CToken_761.value.mantissa * <span class='self'>self</span>.data.borrowIndex), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.borrowIndex = ((compute_CToken_761.value.mantissa * <span class='self'>self</span>.data.borrowIndex) // <span class='self'>self</span>.data.expScale) + <span class='self'>self</span>.data.borrowIndex
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.accrualBlockNumber = sp.level</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> exchangeRateStored(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;__s2 = sp.bind_block("__s2"):
<br>&nbsp;&nbsp;with __s2:
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.fst(params), sp.TUnit)
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>excRate</span> = sp.local("<span class='local'>excRate</span>", <span class='self'>self</span>.data.initialExchangeRateMantissa)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='constant'>0</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves), sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.verify(<span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>, <span class='constant'>'DIVISION_BY_ZERO'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type((sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;excRate.value = (sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.result(excRate.value)
<br>&nbsp;&nbsp;sp.set_type(sp.snd(params), sp.TContract(sp.TNat))
<br>&nbsp;&nbsp;sp.transfer(__s2.value, <span class='constant'>sp.tez(0)</span>, sp.snd(params))</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> getAccountSnapshot(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;__s3 = sp.bind_block("__s3"):
<br>&nbsp;&nbsp;with __s3:
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>compute_CToken_565</span> = sp.local("<span class='local'>compute_CToken_565</span>", sp.record(account = sp.fst(params), borrowBalance = <span class='constant'>0</span>, cTokenBalance = <span class='constant'>0</span>, exchangeRateMantissa = <span class='constant'>0</span>))
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.ledger.contains(sp.fst(params)):
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.verify(sp.level == <span class='self'>self</span>.data.accrualBlockNumber, <span class='constant'>'CT_INTEREST_OLD'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;compute_CToken_565.value.cTokenBalance = <span class='self'>self</span>.data.ledger[sp.fst(params)].balance
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>borrowBalance</span> = sp.local("<span class='local'>borrowBalance</span>", <span class='constant'>0</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.borrows.contains(sp.fst(params)):
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>borrowSnapshot</span> = sp.local("<span class='local'>borrowSnapshot</span>", <span class='self'>self</span>.data.borrows[sp.fst(params)])
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.if borrowSnapshot.value.principal > <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;borrowBalance.value = (borrowSnapshot.value.principal * <span class='self'>self</span>.data.borrowIndex) // borrowSnapshot.value.interestIndex
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;compute_CToken_565.value.borrowBalance = borrowBalance.value
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>excRate</span> = sp.local("<span class='local'>excRate</span>", <span class='self'>self</span>.data.initialExchangeRateMantissa)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='constant'>0</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves), sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.verify(<span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>, <span class='constant'>'DIVISION_BY_ZERO'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type((sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;excRate.value = (sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;compute_CToken_565.value.exchangeRateMantissa = excRate.value
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.result(compute_CToken_565.value)
<br>&nbsp;&nbsp;sp.set_type(sp.snd(params), sp.TContract(sp.TRecord(account = sp.TAddress, borrowBalance = sp.TNat, cTokenBalance = sp.TNat, exchangeRateMantissa = sp.TNat).layout((("account", "borrowBalance"), ("cTokenBalance", "exchangeRateMantissa")))))
<br>&nbsp;&nbsp;sp.transfer(__s3.value, <span class='constant'>sp.tez(0)</span>, sp.snd(params))</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> getAllowance(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;__s4 = sp.bind_block("__s4"):
<br>&nbsp;&nbsp;with __s4:
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>result</span> = sp.local("<span class='local'>result</span>", <span class='constant'>0</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.ledger.contains(sp.fst(params).owner):
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.ledger[sp.fst(params).owner].approvals.contains(sp.fst(params).spender):
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.value = <span class='self'>self</span>.data.ledger[sp.fst(params).owner].approvals[sp.fst(params).spender]
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.result(result.value)
<br>&nbsp;&nbsp;sp.set_type(sp.snd(params), sp.TContract(sp.TNat))
<br>&nbsp;&nbsp;sp.transfer(__s4.value, <span class='constant'>sp.tez(0)</span>, sp.snd(params))</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> getBalance(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;__s5 = sp.bind_block("__s5"):
<br>&nbsp;&nbsp;with __s5:
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>result</span> = sp.local("<span class='local'>result</span>", <span class='constant'>0</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.ledger.contains(sp.fst(params)):
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.value = <span class='self'>self</span>.data.ledger[sp.fst(params)].balance
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.result(result.value)
<br>&nbsp;&nbsp;sp.set_type(sp.snd(params), sp.TContract(sp.TNat))
<br>&nbsp;&nbsp;sp.transfer(__s5.value, <span class='constant'>sp.tez(0)</span>, sp.snd(params))</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> getBalanceOfUnderlying(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;__s6 = sp.bind_block("__s6"):
<br>&nbsp;&nbsp;with __s6:
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.fst(params), sp.TAddress)
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>excRate</span> = sp.local("<span class='local'>excRate</span>", <span class='self'>self</span>.data.initialExchangeRateMantissa)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='constant'>0</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves), sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.verify(<span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>, <span class='constant'>'DIVISION_BY_ZERO'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type((sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;excRate.value = (sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(excRate.value, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.ledger[sp.fst(params)].balance, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(excRate.value * <span class='self'>self</span>.data.ledger[sp.fst(params)].balance, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value * <span class='self'>self</span>.data.ledger[sp.fst(params)].balance), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.result((excRate.value * <span class='self'>self</span>.data.ledger[sp.fst(params)].balance) // <span class='self'>self</span>.data.expScale)
<br>&nbsp;&nbsp;sp.set_type(sp.snd(params), sp.TContract(sp.TNat))
<br>&nbsp;&nbsp;sp.transfer(__s6.value, <span class='constant'>sp.tez(0)</span>, sp.snd(params))</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> getCash(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;__s7 = sp.bind_block("__s7"):
<br>&nbsp;&nbsp;with __s7:
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.fst(params), sp.TUnit)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.result(<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>)
<br>&nbsp;&nbsp;sp.set_type(sp.snd(params), sp.TContract(sp.TNat))
<br>&nbsp;&nbsp;sp.transfer(__s7.value, <span class='constant'>sp.tez(0)</span>, sp.snd(params))</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> getTotalSupply(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;__s8 = sp.bind_block("__s8"):
<br>&nbsp;&nbsp;with __s8:
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.fst(params), sp.TUnit)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.result(<span class='self'>self</span>.data.totalSupply)
<br>&nbsp;&nbsp;sp.set_type(sp.snd(params), sp.TContract(sp.TNat))
<br>&nbsp;&nbsp;sp.transfer(__s8.value, <span class='constant'>sp.tez(0)</span>, sp.snd(params))</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> hardResetOp(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TUnit)
<br>&nbsp;&nbsp;sp.verify(sp.sender == <span class='self'>self</span>.data.administrator, <span class='constant'>'CT_NOT_ADMIN'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.activeOperations = sp.set([])</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> liquidateBorrow(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TRecord(borrower = sp.TAddress, cTokenCollateral = sp.TAddress, repayAmount = sp.TNat).layout(("borrower", ("cTokenCollateral", "repayAmount"))))
<br>&nbsp;&nbsp;sp.transfer(sp.record(borrower = params.borrower, cTokenBorrowed = sp.self_address, cTokenCollateral = params.cTokenCollateral, liquidator = sp.sender, repayAmount = params.repayAmount), <span class='constant'>sp.tez(0)</span>, sp.contract(sp.TRecord(borrower = sp.TAddress, cTokenBorrowed = sp.TAddress, cTokenCollateral = sp.TAddress, liquidator = sp.TAddress, repayAmount = sp.TNat).layout((("borrower", "cTokenBorrowed"), ("cTokenCollateral", ("liquidator", "repayAmount")))), <span class='self'>self</span>.data.comptroller, entrypoint='liquidateBorrowAllowed').open_some())
<br>&nbsp;&nbsp;sp.verify(params.borrower != sp.sender, <span class='constant'>'CT_LIQUIDATE_LIQUIDATOR_IS_BORROWER'</span>)
<br>&nbsp;&nbsp;sp.verify(params.repayAmount > <span class='constant'>0</span>, <span class='constant'>'CT_LIQUIDATE_CLOSE_AMOUNT_IS_INVALID'</span>)
<br>&nbsp;&nbsp;sp.verify(sp.level == <span class='self'>self</span>.data.accrualBlockNumber, <span class='constant'>'CT_INTEREST_OLD'</span>)
<br>&nbsp;&nbsp;<span class='local'>borrowBalance</span> = sp.local("<span class='local'>borrowBalance</span>", <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.borrows.contains(params.borrower):
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>borrowSnapshot</span> = sp.local("<span class='local'>borrowSnapshot</span>", <span class='self'>self</span>.data.borrows[params.borrower])
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if borrowSnapshot.value.principal > <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;borrowBalance.value = (borrowSnapshot.value.principal * <span class='self'>self</span>.data.borrowIndex) // borrowSnapshot.value.interestIndex
<br>&nbsp;&nbsp;sp.set_type(borrowBalance.value, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(sp.min(borrowBalance.value, params.repayAmount), sp.TNat)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.borrows[params.borrower].principal = sp.as_nat(borrowBalance.value - sp.min(borrowBalance.value, params.repayAmount), message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.borrows[params.borrower].interestIndex = <span class='self'>self</span>.data.borrowIndex
<br>&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalBorrows, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(sp.min(borrowBalance.value, params.repayAmount), sp.TNat)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.totalBorrows = sp.as_nat(<span class='self'>self</span>.data.totalBorrows - sp.min(borrowBalance.value, params.repayAmount), message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>)
<br>&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.borrows[params.borrower].principal == <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.transfer(params.borrower, <span class='constant'>sp.tez(0)</span>, sp.contract(sp.TAddress, <span class='self'>self</span>.data.comptroller, entrypoint='removeFromLoans').open_some())
<br>&nbsp;&nbsp;sp.verify(sp.view("balanceOf", params.borrower, params.cTokenCollateral, sp.TNat).open_some(message = <span class='constant'>'INVALID BALANCE OF VIEW'</span>) >= sp.view("liquidateCalculateSeizeTokens", sp.record(actualRepayAmount = params.repayAmount, cTokenBorrowed = sp.self_address, cTokenCollateral = params.cTokenCollateral), <span class='self'>self</span>.data.comptroller, sp.TNat).open_some(message = <span class='constant'>'INVALID LIQUIDATE CALC SEIZE TOKEN VIEW'</span>), <span class='constant'>'LIQUIDATE_SEIZE_TOO_MUCH'</span>)
<br>&nbsp;&nbsp;sp.transfer(sp.record(borrower = params.borrower, liquidator = sp.sender, seizeTokens = sp.view("liquidateCalculateSeizeTokens", sp.record(actualRepayAmount = params.repayAmount, cTokenBorrowed = sp.self_address, cTokenCollateral = params.cTokenCollateral), <span class='self'>self</span>.data.comptroller, sp.TNat).open_some(message = <span class='constant'>'INVALID LIQUIDATE CALC SEIZE TOKEN VIEW'</span>)), <span class='constant'>sp.tez(0)</span>, sp.contract(sp.TRecord(borrower = sp.TAddress, liquidator = sp.TAddress, seizeTokens = sp.TNat).layout(("borrower", ("liquidator", "seizeTokens"))), params.cTokenCollateral, entrypoint='seize').open_some())</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> mint(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;sp.verify(sp.sender != sp.self_address, <span class='constant'>'CT_INTERNAL_CALL'</span>)
<br>&nbsp;&nbsp;sp.if ~ (<span class='self'>self</span>.data.ledger.contains(sp.sender)):
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.ledger[sp.sender] = sp.record(approvals = {}, balance = <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.if ~ (<span class='self'>self</span>.data.borrows.contains(sp.sender)):
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.borrows[sp.sender] = sp.record(interestIndex = <span class='constant'>0</span>, principal = <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.transfer(sp.record(cToken = sp.self_address, mintAmount = params, minter = sp.sender), <span class='constant'>sp.tez(0)</span>, sp.contract(sp.TRecord(cToken = sp.TAddress, mintAmount = sp.TNat, minter = sp.TAddress).layout(("cToken", ("minter", "mintAmount"))), <span class='self'>self</span>.data.comptroller, entrypoint='mintAllowed').open_some())
<br>&nbsp;&nbsp;sp.verify(sp.level == <span class='self'>self</span>.data.accrualBlockNumber, <span class='constant'>'CT_INTEREST_OLD'</span>)
<br>&nbsp;&nbsp;<span class='local'>excRate</span> = sp.local("<span class='local'>excRate</span>", <span class='self'>self</span>.data.initialExchangeRateMantissa)
<br>&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='constant'>0</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves), sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.verify(<span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>, <span class='constant'>'DIVISION_BY_ZERO'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type((sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;excRate.value = (sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply
<br>&nbsp;&nbsp;<span class='local'>amount</span> = sp.local("<span class='local'>amount</span>", <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.if <span class='constant'>True</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(excRate.value, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.verify(excRate.value > <span class='constant'>0</span>, <span class='constant'>'DIVISION_BY_ZERO'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>compute_CToken_965</span> = sp.local("<span class='local'>compute_CToken_965</span>", (params * <span class='self'>self</span>.data.expScale) // excRate.value)
<br>&nbsp;&nbsp;&nbsp;&nbsp;amount.value = compute_CToken_965.value
<br>&nbsp;&nbsp;sp.else:
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(excRate.value, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(excRate.value * params, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value * params), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>compute_CToken_968</span> = sp.local("<span class='local'>compute_CToken_968</span>", (excRate.value * params) // <span class='self'>self</span>.data.expScale)
<br>&nbsp;&nbsp;&nbsp;&nbsp;amount.value = compute_CToken_968.value
<br>&nbsp;&nbsp;sp.verify(amount.value > <span class='constant'>0</span>, <span class='constant'>'CT_MINT_AMOUNT_IS_INVALID'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.totalSupply += amount.value
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.ledger[sp.sender].balance += amount.value</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> redeem(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;sp.verify(sp.sender != sp.self_address, <span class='constant'>'CT_INTERNAL_CALL'</span>)
<br>&nbsp;&nbsp;sp.transfer(sp.record(cToken = sp.self_address, redeemAmount = params, redeemer = sp.sender), <span class='constant'>sp.tez(0)</span>, sp.contract(sp.TRecord(cToken = sp.TAddress, redeemAmount = sp.TNat, redeemer = sp.TAddress).layout(("cToken", ("redeemer", "redeemAmount"))), <span class='self'>self</span>.data.comptroller, entrypoint='redeemAllowed').open_some())
<br>&nbsp;&nbsp;<span class='local'>redeem_amount</span> = sp.local("<span class='local'>redeem_amount</span>", <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.if <span class='constant'>False</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;redeem_amount.value = params
<br>&nbsp;&nbsp;sp.else:
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>excRate</span> = sp.local("<span class='local'>excRate</span>", <span class='self'>self</span>.data.initialExchangeRateMantissa)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='constant'>0</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves), sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.verify(<span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>, <span class='constant'>'DIVISION_BY_ZERO'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type((sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;excRate.value = (sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>amount</span> = sp.local("<span class='local'>amount</span>", <span class='constant'>0</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='constant'>False</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(excRate.value, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.verify(excRate.value > <span class='constant'>0</span>, <span class='constant'>'DIVISION_BY_ZERO'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>compute_CToken_965</span> = sp.local("<span class='local'>compute_CToken_965</span>", (params * <span class='self'>self</span>.data.expScale) // excRate.value)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount.value = compute_CToken_965.value
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.else:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(excRate.value, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(excRate.value * params, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value * params), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>compute_CToken_968</span> = sp.local("<span class='local'>compute_CToken_968</span>", (excRate.value * params) // <span class='self'>self</span>.data.expScale)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount.value = compute_CToken_968.value
<br>&nbsp;&nbsp;&nbsp;&nbsp;redeem_amount.value = amount.value
<br>&nbsp;&nbsp;<span class='local'>redeem_tokens</span> = sp.local("<span class='local'>redeem_tokens</span>", <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.if <span class='constant'>False</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>excRate</span> = sp.local("<span class='local'>excRate</span>", <span class='self'>self</span>.data.initialExchangeRateMantissa)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='constant'>0</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves), sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.verify(<span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>, <span class='constant'>'DIVISION_BY_ZERO'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type((sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;excRate.value = (sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>amount</span> = sp.local("<span class='local'>amount</span>", <span class='constant'>0</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='constant'>True</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(excRate.value, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.verify(excRate.value > <span class='constant'>0</span>, <span class='constant'>'DIVISION_BY_ZERO'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>compute_Exponential_277</span> = sp.local("<span class='local'>compute_Exponential_277</span>", params * <span class='self'>self</span>.data.expScale)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>compute_Exponential_280</span> = sp.local("<span class='local'>compute_Exponential_280</span>", compute_Exponential_277.value // excRate.value)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.if (compute_Exponential_277.value % excRate.value) > <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pass
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>compute_CToken_976</span> = sp.local("<span class='local'>compute_CToken_976</span>", compute_Exponential_280.value + <span class='constant'>1</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount.value = compute_CToken_976.value
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.else:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(excRate.value, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(excRate.value * params, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value * params), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>compute_CToken_979</span> = sp.local("<span class='local'>compute_CToken_979</span>", (excRate.value * params) // <span class='self'>self</span>.data.expScale)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount.value = compute_CToken_979.value
<br>&nbsp;&nbsp;&nbsp;&nbsp;redeem_tokens.value = amount.value
<br>&nbsp;&nbsp;sp.else:
<br>&nbsp;&nbsp;&nbsp;&nbsp;redeem_tokens.value = params
<br>&nbsp;&nbsp;sp.if (redeem_amount.value > <span class='constant'>0</span>) & (redeem_tokens.value > <span class='constant'>0</span>):
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.verify((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) >= redeem_amount.value, <span class='constant'>'CT_INSUFFICIENT_CASH'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.verify(sp.level == <span class='self'>self</span>.data.accrualBlockNumber, <span class='constant'>'CT_INTEREST_OLD'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.totalSupply = sp.as_nat(<span class='self'>self</span>.data.totalSupply - redeem_tokens.value, message = <span class='constant'>'Insufficient supply'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.ledger[sp.sender].balance = sp.as_nat(<span class='self'>self</span>.data.ledger[sp.sender].balance - redeem_tokens.value, message = <span class='constant'>'Insufficient balance'</span>)</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> redeemUnderlying(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;sp.verify(sp.sender != sp.self_address, <span class='constant'>'CT_INTERNAL_CALL'</span>)
<br>&nbsp;&nbsp;sp.transfer(sp.record(cToken = sp.self_address, redeemAmount = params, redeemer = sp.sender), <span class='constant'>sp.tez(0)</span>, sp.contract(sp.TRecord(cToken = sp.TAddress, redeemAmount = sp.TNat, redeemer = sp.TAddress).layout(("cToken", ("redeemer", "redeemAmount"))), <span class='self'>self</span>.data.comptroller, entrypoint='redeemAllowed').open_some())
<br>&nbsp;&nbsp;<span class='local'>redeem_amount</span> = sp.local("<span class='local'>redeem_amount</span>", <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.if <span class='constant'>True</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;redeem_amount.value = params
<br>&nbsp;&nbsp;sp.else:
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>excRate</span> = sp.local("<span class='local'>excRate</span>", <span class='self'>self</span>.data.initialExchangeRateMantissa)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='constant'>0</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves), sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.verify(<span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>, <span class='constant'>'DIVISION_BY_ZERO'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type((sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;excRate.value = (sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>amount</span> = sp.local("<span class='local'>amount</span>", <span class='constant'>0</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='constant'>False</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(excRate.value, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.verify(excRate.value > <span class='constant'>0</span>, <span class='constant'>'DIVISION_BY_ZERO'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>compute_CToken_965</span> = sp.local("<span class='local'>compute_CToken_965</span>", (params * <span class='self'>self</span>.data.expScale) // excRate.value)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount.value = compute_CToken_965.value
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.else:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(excRate.value, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(excRate.value * params, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value * params), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>compute_CToken_968</span> = sp.local("<span class='local'>compute_CToken_968</span>", (excRate.value * params) // <span class='self'>self</span>.data.expScale)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount.value = compute_CToken_968.value
<br>&nbsp;&nbsp;&nbsp;&nbsp;redeem_amount.value = amount.value
<br>&nbsp;&nbsp;<span class='local'>redeem_tokens</span> = sp.local("<span class='local'>redeem_tokens</span>", <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.if <span class='constant'>True</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>excRate</span> = sp.local("<span class='local'>excRate</span>", <span class='self'>self</span>.data.initialExchangeRateMantissa)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='constant'>0</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves), sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.verify(<span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>, <span class='constant'>'DIVISION_BY_ZERO'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type((sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;excRate.value = (sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>amount</span> = sp.local("<span class='local'>amount</span>", <span class='constant'>0</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='constant'>True</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(excRate.value, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.verify(excRate.value > <span class='constant'>0</span>, <span class='constant'>'DIVISION_BY_ZERO'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>compute_Exponential_277</span> = sp.local("<span class='local'>compute_Exponential_277</span>", params * <span class='self'>self</span>.data.expScale)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>compute_Exponential_280</span> = sp.local("<span class='local'>compute_Exponential_280</span>", compute_Exponential_277.value // excRate.value)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.if (compute_Exponential_277.value % excRate.value) > <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pass
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>compute_CToken_976</span> = sp.local("<span class='local'>compute_CToken_976</span>", compute_Exponential_280.value + <span class='constant'>1</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount.value = compute_CToken_976.value
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.else:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(excRate.value, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(excRate.value * params, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value * params), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>compute_CToken_979</span> = sp.local("<span class='local'>compute_CToken_979</span>", (excRate.value * params) // <span class='self'>self</span>.data.expScale)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount.value = compute_CToken_979.value
<br>&nbsp;&nbsp;&nbsp;&nbsp;redeem_tokens.value = amount.value
<br>&nbsp;&nbsp;sp.else:
<br>&nbsp;&nbsp;&nbsp;&nbsp;redeem_tokens.value = params
<br>&nbsp;&nbsp;sp.if (redeem_amount.value > <span class='constant'>0</span>) & (redeem_tokens.value > <span class='constant'>0</span>):
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.verify((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) >= redeem_amount.value, <span class='constant'>'CT_INSUFFICIENT_CASH'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.verify(sp.level == <span class='self'>self</span>.data.accrualBlockNumber, <span class='constant'>'CT_INTEREST_OLD'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.totalSupply = sp.as_nat(<span class='self'>self</span>.data.totalSupply - redeem_tokens.value, message = <span class='constant'>'Insufficient supply'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.ledger[sp.sender].balance = sp.as_nat(<span class='self'>self</span>.data.ledger[sp.sender].balance - redeem_tokens.value, message = <span class='constant'>'Insufficient balance'</span>)</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> reduceReserves(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;sp.verify(sp.sender == <span class='self'>self</span>.data.administrator, <span class='constant'>'CT_NOT_ADMIN'</span>)
<br>&nbsp;&nbsp;sp.verify(sp.len(<span class='self'>self</span>.data.activeOperations) == <span class='constant'>0</span>, <span class='constant'>'OP_IN_PROGRESS'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.activeOperations.add(<span class='constant'>12</span>)
<br>&nbsp;&nbsp;sp.transfer(<span class='constant'>sp.unit</span>, <span class='constant'>sp.tez(0)</span>, sp.self_entrypoint('accrueInterest'))
<br>&nbsp;&nbsp;sp.transfer(params, sp.amount, sp.self_entrypoint('reduceReservesInternal'))</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> reduceReservesInternal(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.verify(sp.sender == sp.self_address, <span class='constant'>'CT_INTERNAL_FUNCTION'</span>)
<br>&nbsp;&nbsp;sp.verify(<span class='self'>self</span>.data.activeOperations.contains(<span class='constant'>12</span>), <span class='constant'>'OP_NOT_ACTIVE'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.activeOperations.remove(<span class='constant'>12</span>)
<br>&nbsp;&nbsp;sp.verify((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) >= params, <span class='constant'>'CT_INSUFFICIENT_CASH'</span>)
<br>&nbsp;&nbsp;sp.verify(params <= <span class='self'>self</span>.data.totalReserves, <span class='constant'>'CT_REDUCE_AMOUNT'</span>)
<br>&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalReserves, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.totalReserves = sp.as_nat(<span class='self'>self</span>.data.totalReserves - params, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>)</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> removePendingGovernance(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TUnit)
<br>&nbsp;&nbsp;sp.verify(sp.sender == <span class='self'>self</span>.data.administrator, <span class='constant'>'CT_NOT_ADMIN'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.pendingAdministrator = sp.none</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> repayBorrow(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;sp.verify(sp.sender != sp.self_address, <span class='constant'>'CT_INTERNAL_CALL'</span>)
<br>&nbsp;&nbsp;sp.if ~ (<span class='self'>self</span>.data.ledger.contains(sp.sender)):
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.ledger[sp.sender] = sp.record(approvals = {}, balance = <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.if ~ (<span class='self'>self</span>.data.borrows.contains(sp.sender)):
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.borrows[sp.sender] = sp.record(interestIndex = <span class='constant'>0</span>, principal = <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.transfer(sp.record(borrower = sp.sender, cToken = sp.self_address, payer = sp.sender, repayAmount = params), <span class='constant'>sp.tez(0)</span>, sp.contract(sp.TRecord(borrower = sp.TAddress, cToken = sp.TAddress, payer = sp.TAddress, repayAmount = sp.TNat).layout(("cToken", ("payer", ("borrower", "repayAmount")))), <span class='self'>self</span>.data.comptroller, entrypoint='repayBorrowAllowed').open_some())
<br>&nbsp;&nbsp;sp.verify(sp.level == <span class='self'>self</span>.data.accrualBlockNumber, <span class='constant'>'CT_INTEREST_OLD'</span>)
<br>&nbsp;&nbsp;<span class='local'>borrowBalance</span> = sp.local("<span class='local'>borrowBalance</span>", <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.borrows.contains(sp.sender):
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>borrowSnapshot</span> = sp.local("<span class='local'>borrowSnapshot</span>", <span class='self'>self</span>.data.borrows[sp.sender])
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if borrowSnapshot.value.principal > <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;borrowBalance.value = (borrowSnapshot.value.principal * <span class='self'>self</span>.data.borrowIndex) // borrowSnapshot.value.interestIndex
<br>&nbsp;&nbsp;sp.set_type(borrowBalance.value, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(sp.min(borrowBalance.value, params), sp.TNat)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.borrows[sp.sender].principal = sp.as_nat(borrowBalance.value - sp.min(borrowBalance.value, params), message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.borrows[sp.sender].interestIndex = <span class='self'>self</span>.data.borrowIndex
<br>&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalBorrows, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(sp.min(borrowBalance.value, params), sp.TNat)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.totalBorrows = sp.as_nat(<span class='self'>self</span>.data.totalBorrows - sp.min(borrowBalance.value, params), message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>)
<br>&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.borrows[sp.sender].principal == <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.transfer(sp.sender, <span class='constant'>sp.tez(0)</span>, sp.contract(sp.TAddress, <span class='self'>self</span>.data.comptroller, entrypoint='removeFromLoans').open_some())</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> repayBorrowBehalf(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TRecord(borrower = sp.TAddress, repayAmount = sp.TNat).layout(("borrower", "repayAmount")))
<br>&nbsp;&nbsp;sp.verify(sp.sender != sp.self_address, <span class='constant'>'CT_INTERNAL_CALL'</span>)
<br>&nbsp;&nbsp;sp.if ~ (<span class='self'>self</span>.data.ledger.contains(sp.sender)):
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.ledger[sp.sender] = sp.record(approvals = {}, balance = <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.if ~ (<span class='self'>self</span>.data.borrows.contains(sp.sender)):
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.borrows[sp.sender] = sp.record(interestIndex = <span class='constant'>0</span>, principal = <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.transfer(sp.record(borrower = params.borrower, cToken = sp.self_address, payer = sp.sender, repayAmount = params.repayAmount), <span class='constant'>sp.tez(0)</span>, sp.contract(sp.TRecord(borrower = sp.TAddress, cToken = sp.TAddress, payer = sp.TAddress, repayAmount = sp.TNat).layout(("cToken", ("payer", ("borrower", "repayAmount")))), <span class='self'>self</span>.data.comptroller, entrypoint='repayBorrowAllowed').open_some())
<br>&nbsp;&nbsp;sp.verify(sp.level == <span class='self'>self</span>.data.accrualBlockNumber, <span class='constant'>'CT_INTEREST_OLD'</span>)
<br>&nbsp;&nbsp;<span class='local'>borrowBalance</span> = sp.local("<span class='local'>borrowBalance</span>", <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.borrows.contains(params.borrower):
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='local'>borrowSnapshot</span> = sp.local("<span class='local'>borrowSnapshot</span>", <span class='self'>self</span>.data.borrows[params.borrower])
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if borrowSnapshot.value.principal > <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;borrowBalance.value = (borrowSnapshot.value.principal * <span class='self'>self</span>.data.borrowIndex) // borrowSnapshot.value.interestIndex
<br>&nbsp;&nbsp;sp.set_type(borrowBalance.value, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(sp.min(borrowBalance.value, params.repayAmount), sp.TNat)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.borrows[params.borrower].principal = sp.as_nat(borrowBalance.value - sp.min(borrowBalance.value, params.repayAmount), message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.borrows[params.borrower].interestIndex = <span class='self'>self</span>.data.borrowIndex
<br>&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalBorrows, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(sp.min(borrowBalance.value, params.repayAmount), sp.TNat)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.totalBorrows = sp.as_nat(<span class='self'>self</span>.data.totalBorrows - sp.min(borrowBalance.value, params.repayAmount), message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>)
<br>&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.borrows[params.borrower].principal == <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.transfer(params.borrower, <span class='constant'>sp.tez(0)</span>, sp.contract(sp.TAddress, <span class='self'>self</span>.data.comptroller, entrypoint='removeFromLoans').open_some())</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> seize(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TRecord(borrower = sp.TAddress, liquidator = sp.TAddress, seizeTokens = sp.TNat).layout(("borrower", ("liquidator", "seizeTokens"))))
<br>&nbsp;&nbsp;sp.if ~ (<span class='self'>self</span>.data.ledger.contains(params.liquidator)):
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.ledger[params.liquidator] = sp.record(approvals = {}, balance = <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.if ~ (<span class='self'>self</span>.data.borrows.contains(params.liquidator)):
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.borrows[params.liquidator] = sp.record(interestIndex = <span class='constant'>0</span>, principal = <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.verify(sp.view("seizeAllowed", sp.record(cTokenBorrowed = sp.sender, cTokenCollateral = sp.self_address), <span class='self'>self</span>.data.comptroller, sp.TBool).open_some(message = <span class='constant'>'INVALID SEIZE ALLOWED VIEW'</span>), <span class='constant'>'CT_LIQUIDATE_SEIZE_COMPTROLLER_REJECTION'</span>)
<br>&nbsp;&nbsp;sp.verify(params.borrower != params.liquidator, <span class='constant'>'CT_LIQUIDATE_SEIZE_LIQUIDATOR_IS_BORROWER'</span>)
<br>&nbsp;&nbsp;sp.verify(sp.level == <span class='self'>self</span>.data.accrualBlockNumber, <span class='constant'>'CT_INTEREST_OLD'</span>)
<br>&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.ledger[params.borrower].balance, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(params.seizeTokens, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.protocolSeizeShareMantissa, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(params.seizeTokens, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(sp.record(mantissa = <span class='self'>self</span>.data.protocolSeizeShareMantissa), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;<span class='local'>protocolSeizeTokens</span> = sp.local("<span class='local'>protocolSeizeTokens</span>", (params.seizeTokens * <span class='self'>self</span>.data.protocolSeizeShareMantissa) // <span class='self'>self</span>.data.expScale)
<br>&nbsp;&nbsp;sp.set_type(params.seizeTokens, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(protocolSeizeTokens.value, sp.TNat)
<br>&nbsp;&nbsp;<span class='local'>excRate</span> = sp.local("<span class='local'>excRate</span>", <span class='self'>self</span>.data.initialExchangeRateMantissa)
<br>&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='constant'>0</span>, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves), sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(sp.record(mantissa = sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.verify(<span class='self'>self</span>.data.totalSupply > <span class='constant'>0</span>, <span class='constant'>'DIVISION_BY_ZERO'</span>)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.set_type((sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;&nbsp;&nbsp;excRate.value = (sp.as_nat((sp.as_nat((<span class='self'>self</span>.data.totalSupply // <span class='constant'>1000000</span>) - <span class='constant'>0</span>, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>) + <span class='self'>self</span>.data.totalBorrows) - <span class='self'>self</span>.data.totalReserves) * <span class='self'>self</span>.data.expScale) // <span class='self'>self</span>.data.totalSupply
<br>&nbsp;&nbsp;sp.set_type(excRate.value, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;sp.set_type(protocolSeizeTokens.value, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(excRate.value * protocolSeizeTokens.value, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(sp.record(mantissa = excRate.value * protocolSeizeTokens.value), sp.TRecord(mantissa = sp.TNat).layout("mantissa"))
<br>&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalReserves, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type((excRate.value * protocolSeizeTokens.value) // <span class='self'>self</span>.data.expScale, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.totalSupply, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(protocolSeizeTokens.value, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(<span class='self'>self</span>.data.ledger[params.liquidator].balance, sp.TNat)
<br>&nbsp;&nbsp;sp.set_type(sp.as_nat(params.seizeTokens - protocolSeizeTokens.value, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>), sp.TNat)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.totalReserves += (excRate.value * protocolSeizeTokens.value) // <span class='self'>self</span>.data.expScale
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.totalSupply = sp.as_nat(<span class='self'>self</span>.data.totalSupply - protocolSeizeTokens.value, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.ledger[params.borrower].balance = sp.as_nat(<span class='self'>self</span>.data.ledger[params.borrower].balance - params.seizeTokens, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.ledger[params.liquidator].balance += sp.as_nat(params.seizeTokens - protocolSeizeTokens.value, message = <span class='constant'>'SUBTRACTION_UNDERFLOW'</span>)</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> setAccountSnapshot(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TRecord(account = sp.TAddress, borrowBalance = sp.TNat, cTokenBalance = sp.TNat, exchangeRateMantissa = sp.TNat).layout((("account", "borrowBalance"), ("cTokenBalance", "exchangeRateMantissa"))))
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.accCTokenBalance = params.cTokenBalance
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.accBorrowBalance = params.borrowBalance
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.accExchangeRateMantissa = params.exchangeRateMantissa</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> setActiveOp(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.activeOperations.add(params)</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> setComptroller(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TAddress)
<br>&nbsp;&nbsp;sp.verify(sp.sender == <span class='self'>self</span>.data.administrator, <span class='constant'>'CT_NOT_ADMIN'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.comptroller = params</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> setInterestRateModel(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TAddress)
<br>&nbsp;&nbsp;sp.verify(sp.sender == <span class='self'>self</span>.data.administrator, <span class='constant'>'CT_NOT_ADMIN'</span>)
<br>&nbsp;&nbsp;sp.verify(sp.len(<span class='self'>self</span>.data.activeOperations) == <span class='constant'>0</span>, <span class='constant'>'OP_IN_PROGRESS'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.activeOperations.add(<span class='constant'>9</span>)
<br>&nbsp;&nbsp;sp.transfer(<span class='constant'>sp.unit</span>, <span class='constant'>sp.tez(0)</span>, sp.self_entrypoint('accrueInterest'))
<br>&nbsp;&nbsp;sp.transfer(params, <span class='constant'>sp.tez(0)</span>, sp.self_entrypoint('setInterestRateModelInternal'))</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> setInterestRateModelInternal(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TAddress)
<br>&nbsp;&nbsp;sp.verify(sp.sender == sp.self_address, <span class='constant'>'CT_INTERNAL_FUNCTION'</span>)
<br>&nbsp;&nbsp;sp.verify(<span class='self'>self</span>.data.activeOperations.contains(<span class='constant'>9</span>), <span class='constant'>'OP_NOT_ACTIVE'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.activeOperations.remove(<span class='constant'>9</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.interestRateModel = params</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> setPendingGovernance(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TAddress)
<br>&nbsp;&nbsp;sp.verify(sp.sender == <span class='self'>self</span>.data.administrator, <span class='constant'>'CT_NOT_ADMIN'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.pendingAdministrator = sp.some(params)</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> setReserveFactor(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;sp.verify(sp.sender == <span class='self'>self</span>.data.administrator, <span class='constant'>'CT_NOT_ADMIN'</span>)
<br>&nbsp;&nbsp;sp.verify(sp.len(<span class='self'>self</span>.data.activeOperations) == <span class='constant'>0</span>, <span class='constant'>'OP_IN_PROGRESS'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.activeOperations.add(<span class='constant'>10</span>)
<br>&nbsp;&nbsp;sp.transfer(<span class='constant'>sp.unit</span>, <span class='constant'>sp.tez(0)</span>, sp.self_entrypoint('accrueInterest'))
<br>&nbsp;&nbsp;sp.transfer(params, <span class='constant'>sp.tez(0)</span>, sp.self_entrypoint('setReserveFactorInternal'))</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> setReserveFactorInternal(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.verify(sp.sender == sp.self_address, <span class='constant'>'CT_INTERNAL_FUNCTION'</span>)
<br>&nbsp;&nbsp;sp.verify(<span class='self'>self</span>.data.activeOperations.contains(<span class='constant'>10</span>), <span class='constant'>'OP_NOT_ACTIVE'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.activeOperations.remove(<span class='constant'>10</span>)
<br>&nbsp;&nbsp;sp.verify(sp.level == <span class='self'>self</span>.data.accrualBlockNumber, <span class='constant'>'CT_INTEREST_OLD'</span>)
<br>&nbsp;&nbsp;sp.verify(params <= <span class='self'>self</span>.data.reserveFactorMaxMantissa, <span class='constant'>'CT_INVALID_RESERVE_FACTOR'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.reserveFactorMantissa = params</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> sweepFA12(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TRecord(amount = sp.TNat, tokenAddress = sp.TAddress).layout(("amount", "tokenAddress")))
<br>&nbsp;&nbsp;sp.transfer(sp.record(from_ = sp.self_address, to_ = <span class='self'>self</span>.data.administrator, value = params.amount), <span class='constant'>sp.tez(0)</span>, sp.contract(sp.TRecord(from_ = sp.TAddress, to_ = sp.TAddress, value = sp.TNat).layout(("from_ as from", ("to_ as to", "value"))), params.tokenAddress, entrypoint='transfer').open_some())</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> sweepFA2(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TRecord(amount = sp.TNat, id = sp.TNat, tokenAddress = sp.TAddress).layout(("amount", ("id", "tokenAddress"))))
<br>&nbsp;&nbsp;sp.transfer(sp.list([sp.record(from_ = sp.self_address, txs = sp.list([sp.record(amount = params.amount, to_ = <span class='self'>self</span>.data.administrator, token_id = params.id)]))]), <span class='constant'>sp.tez(0)</span>, sp.contract(sp.TList(sp.TRecord(from_ = sp.TAddress, txs = sp.TList(sp.TRecord(amount = sp.TNat, to_ = sp.TAddress, token_id = sp.TNat).layout(("to_", ("token_id", "amount"))))).layout(("from_", "txs"))), params.tokenAddress, entrypoint='transfer').open_some())</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> sweepMutez(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TBool)
<br>&nbsp;&nbsp;sp.if params:
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.send(<span class='self'>self</span>.data.administrator, sp.balance)
<br>&nbsp;&nbsp;sp.else:
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.send(<span class='self'>self</span>.data.administrator, sp.balance)</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> transfer(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TRecord(from_ = sp.TAddress, to_ = sp.TAddress, value = sp.TNat).layout(("from_ as from", ("to_ as to", "value"))))
<br>&nbsp;&nbsp;sp.verify((params.from_ == sp.sender) | (<span class='self'>self</span>.data.ledger[params.from_].approvals[sp.sender] >= params.value), <span class='constant'>'FA1.2_NotAllowed'</span>)
<br>&nbsp;&nbsp;sp.verify(sp.sender != sp.self_address, <span class='constant'>'CT_INTERNAL_CALL'</span>)
<br>&nbsp;&nbsp;sp.if ~ (<span class='self'>self</span>.data.ledger.contains(params.to_)):
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.ledger[params.to_] = sp.record(approvals = {}, balance = <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.if ~ (<span class='self'>self</span>.data.borrows.contains(params.to_)):
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.borrows[params.to_] = sp.record(interestIndex = <span class='constant'>0</span>, principal = <span class='constant'>0</span>)
<br>&nbsp;&nbsp;sp.transfer(sp.record(cToken = sp.self_address, dst = params.to_, src = params.from_, transferTokens = params.value), <span class='constant'>sp.tez(0)</span>, sp.contract(sp.TRecord(cToken = sp.TAddress, dst = sp.TAddress, src = sp.TAddress, transferTokens = sp.TNat).layout((("cToken", "src"), ("dst", "transferTokens"))), <span class='self'>self</span>.data.comptroller, entrypoint='transferAllowed').open_some())
<br>&nbsp;&nbsp;sp.set_type(sp.record(from_ = params.from_, sender = sp.sender, to_ = params.to_, value = params.value), sp.TRecord(from_ = sp.TAddress, sender = sp.TAddress, to_ = sp.TAddress, value = sp.TNat).layout((("from_", "sender"), ("to_", "value"))))
<br>&nbsp;&nbsp;sp.verify(<span class='self'>self</span>.data.ledger[params.from_].balance >= params.value, <span class='constant'>'FA1.2_InsufficientBalance'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.ledger[params.from_].balance = sp.as_nat(<span class='self'>self</span>.data.ledger[params.from_].balance - params.value)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.ledger[params.to_].balance += params.value
<br>&nbsp;&nbsp;sp.if params.from_ != sp.sender:
<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class='self'>self</span>.data.ledger[params.from_].approvals[sp.sender] = sp.as_nat(<span class='self'>self</span>.data.ledger[params.from_].approvals[sp.sender] - params.value)
<br>&nbsp;&nbsp;&nbsp;&nbsp;sp.if <span class='self'>self</span>.data.ledger[params.from_].approvals[sp.sender] == <span class='constant'>0</span>:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class='keyword'>del</span> <span class='self'>self</span>.data.ledger[params.from_].approvals[sp.sender]</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> updateAccountSnapshot(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.transfer((params, sp.self_entrypoint('setAccountSnapshot')), <span class='constant'>sp.tez(0)</span>, sp.self_entrypoint('getAccountSnapshot'))</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> updateMetadata(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TRecord(key = sp.TString, value = sp.TBytes).layout(("key", "value")))
<br>&nbsp;&nbsp;sp.verify(sp.sender == <span class='self'>self</span>.data.administrator, <span class='constant'>'CT_NOT_ADMIN'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.metadata[params.key] = params.value</div></div>
<br><div class='on'>
  @sp.entrypoint
<br><span class='keyword'>def</span> updateProtocolSeizeShare(<span class='self'>self</span>, params)<span class='keyword'>:</span><br><div class='indent5'>&nbsp;&nbsp;sp.set_type(params, sp.TNat)
<br>&nbsp;&nbsp;sp.verify(sp.sender == <span class='self'>self</span>.data.administrator, <span class='constant'>'CT_NOT_ADMIN'</span>)
<br>&nbsp;&nbsp;<span class='self'>self</span>.data.protocolSeizeShareMantissa = params</div></div>
<br>
<br>sp.add_compilation_target("test", Contract())</div></div></div></html>